(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1037],{172:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(157).A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},738:(e,t,r)=>{"use strict";r.d(t,{OnboardingForm:()=>S});var a=r(5155),s=r(2115),n=r(2177),l=r(221),i=r(5594),o=r(5317),u=r(858),c=r(8214),d=r(8030),f=r(7481),h=r(9737),m=r(5695),p=r(6010),g=r(285),x=r(7759),y=r(2523),j=r(6695),v=r(172),b=r(1721),w=r(8763),N=r(9311),k=r(1394),A=r(9409);let P=i.Ik({phone:i.Yj().min(10,{message:"Please enter a valid 10-digit phone number."}).max(15,{message:"Phone number is too long."}),region:i.Yj().min(1,"Please select your region.")});function S(){let{user:e,loading:t,refreshUserData:r}=(0,d.A)(),i=(0,m.useRouter)(),{toast:S}=(0,f.dj)(),[R,C]=(0,s.useState)([]),[L,U]=(0,s.useState)(!0),[I,B]=(0,s.useState)(""),[E,_]=(0,s.useState)(!1),[D,M]=(0,s.useState)(!1),[V,O]=(0,s.useState)(!1),[q,H]=(0,s.useState)(!1),[z,T]=(0,s.useState)(null),[F,G]=(0,s.useState)(null),[K,Y]=(0,s.useState)(null),J=(0,s.useRef)(null),Z=(0,s.useRef)(null),$=(0,s.useRef)(null),W=(0,n.mN)({resolver:(0,l.u)(P),defaultValues:{phone:"",region:""}});(0,s.useEffect)(()=>{t||e||i.replace("/signup")},[e,t,i]),(0,s.useEffect)(()=>{!async function(){U(!0);try{let e=await (0,p.getGiftbitRegions)();C(e)}catch(e){S({variant:"destructive",title:"Error",description:"Could not load regions. Please try refreshing."})}finally{U(!1)}}()},[S]);let Q=e=>{B(X(e.target.value)),W.setValue("phone",e.target.value.replace(/\D/g,""),{shouldDirty:!0})},X=e=>{let t=e.replace(/\D/g,""),r="";return t.length>0&&(r="("+t.substring(0,3)),t.length>=4&&(r+=") "+t.substring(3,6)),t.length>=7&&(r+="-"+t.substring(6,10)),r},ee=(t,r,a)=>async s=>{if(!s.target.files||0===s.target.files.length||!e)return;let n=s.target.files[0];if(n.size>2097152)return void S({variant:"destructive",title:"File Too Large",description:"Please select a file smaller than 2MB."});let l=n.name.split(".").pop(),i="".concat((0,h.A)(),".").concat(l),o=(0,u.KR)(c.IG,"".concat(t,"/").concat(e.uid,"/").concat(i));r(!0);try{let e=await (0,u.D)(o,n),t=await (0,u.qk)(e.ref);a(t)}catch(e){console.error("Error uploading file: ",e),S({variant:"destructive",title:"Upload Failed",description:"Could not upload your image."})}finally{r(!1)}},et=ee("profile-pictures",M,T),er=ee("personal-logos",O,G),ea=ee("brokerage-logos",H,Y);async function es(t){if(!e)return void S({variant:"destructive",title:"Error",description:"You must be logged in."});_(!0);try{let a=(0,o.H9)(c.db,"users",e.uid);await (0,o.BN)(a,{phone:t.phone,region:t.region,photoURL:z,personalLogoUrl:F,brokerageLogoUrl:K},{merge:!0}),await r(),i.push("/user/dashboard")}catch(e){console.error("Error saving profile:",e),S({variant:"destructive",title:"Save Failed",description:"Could not save your profile."})}finally{_(!1)}}if(t||!e)return(0,a.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,a.jsx)(v.A,{className:"h-8 w-8 animate-spin text-muted-foreground"})});let en=Array.from(new Map(R.map(e=>[e.code,e])).values());return(0,a.jsx)(j.Zp,{children:(0,a.jsx)(x.lV,{...W,children:(0,a.jsxs)("form",{onSubmit:W.handleSubmit(es),children:[(0,a.jsxs)(j.Wu,{className:"space-y-6 pt-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,a.jsx)(x.zB,{control:W.control,name:"phone",render:e=>{let{field:t}=e;return(0,a.jsxs)(x.eI,{children:[(0,a.jsx)(x.lR,{children:"Phone Number"}),(0,a.jsx)(x.MJ,{children:(0,a.jsx)(y.p,{placeholder:"(555) 555-5555",...t,value:I,onChange:Q,maxLength:14})}),(0,a.jsx)(x.C5,{})]})}}),(0,a.jsx)(x.zB,{control:W.control,name:"region",render:e=>{let{field:t}=e;return(0,a.jsxs)(x.eI,{children:[(0,a.jsx)(x.lR,{children:"Your Region"}),(0,a.jsxs)(A.l6,{onValueChange:t.onChange,defaultValue:t.value,disabled:L,children:[(0,a.jsx)(x.MJ,{children:(0,a.jsx)(A.bq,{children:(0,a.jsx)(A.yv,{placeholder:L?"Loading regions...":"Select your region"})})}),(0,a.jsx)(A.gC,{children:en.map(e=>(0,a.jsxs)(A.eb,{value:e.code,children:[e.name," (",e.currency,")"]},e.code))})]}),(0,a.jsx)(x.C5,{})]})}})]}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-6 items-center justify-around pt-4",children:[(0,a.jsxs)(x.eI,{className:"flex flex-col items-center gap-2",children:[(0,a.jsx)(x.lR,{children:"Your Photo"}),(0,a.jsxs)("div",{className:"relative group",children:[(0,a.jsxs)(k.eu,{className:"h-24 w-24",children:[(0,a.jsx)(k.BK,{src:z||"",alt:"Profile Photo",className:"object-top","data-ai-hint":"person headshot"}),(0,a.jsx)(k.q5,{className:"text-3xl",children:(0,a.jsx)(b.A,{className:"h-10 w-10 text-muted-foreground"})})]}),(0,a.jsx)("button",{type:"button",onClick:()=>{var e;return null==(e=J.current)?void 0:e.click()},disabled:D,className:"absolute inset-0 bg-black/50 flex items-center justify-center rounded-full opacity-0 group-hover:opacity-100 transition-opacity",children:D?(0,a.jsx)(v.A,{className:"h-8 w-8 text-white animate-spin"}):(0,a.jsx)(w.A,{className:"h-8 w-8 text-white"})}),(0,a.jsx)("input",{type:"file",ref:J,onChange:et,className:"hidden",accept:"image/*"})]})]}),(0,a.jsxs)(x.eI,{className:"flex flex-col items-center gap-2",children:[(0,a.jsx)(x.lR,{children:"Personal Logo"}),(0,a.jsxs)("div",{className:"relative group",children:[(0,a.jsxs)(k.eu,{className:"h-24 w-24 rounded-md",children:[(0,a.jsx)(k.BK,{src:F||"",alt:"Personal Logo",className:"object-contain","data-ai-hint":"company logo"}),(0,a.jsx)(k.q5,{className:"rounded-md",children:(0,a.jsx)(N.A,{className:"h-10 w-10 text-muted-foreground"})})]}),(0,a.jsx)("button",{type:"button",onClick:()=>{var e;return null==(e=Z.current)?void 0:e.click()},disabled:V,className:"absolute inset-0 bg-black/50 flex items-center justify-center rounded-md opacity-0 group-hover:opacity-100 transition-opacity",children:V?(0,a.jsx)(v.A,{className:"h-8 w-8 text-white animate-spin"}):(0,a.jsx)(w.A,{className:"h-8 w-8 text-white"})}),(0,a.jsx)("input",{type:"file",ref:Z,onChange:er,className:"hidden",accept:"image/*"})]})]}),(0,a.jsxs)(x.eI,{className:"flex flex-col items-center gap-2",children:[(0,a.jsx)(x.lR,{children:"Brokerage Logo"}),(0,a.jsxs)("div",{className:"relative group",children:[(0,a.jsxs)(k.eu,{className:"h-24 w-24 rounded-md",children:[(0,a.jsx)(k.BK,{src:K||"",alt:"Brokerage Logo",className:"object-contain","data-ai-hint":"company logo"}),(0,a.jsx)(k.q5,{className:"rounded-md",children:(0,a.jsx)(N.A,{className:"h-10 w-10 text-muted-foreground"})})]}),(0,a.jsx)("button",{type:"button",onClick:()=>{var e;return null==(e=$.current)?void 0:e.click()},disabled:q,className:"absolute inset-0 bg-black/50 flex items-center justify-center rounded-md opacity-0 group-hover:opacity-100 transition-opacity",children:q?(0,a.jsx)(v.A,{className:"h-8 w-8 text-white animate-spin"}):(0,a.jsx)(w.A,{className:"h-8 w-8 text-white"})}),(0,a.jsx)("input",{type:"file",ref:$,onChange:ea,className:"hidden",accept:"image/*"})]})]})]})]}),(0,a.jsxs)(j.wL,{className:"flex flex-col-reverse sm:flex-row gap-2",children:[(0,a.jsx)(g.$,{variant:"ghost",onClick:()=>{i.push("/user/dashboard")},className:"w-full sm:w-auto",type:"button",children:"Skip for Now"}),(0,a.jsx)(g.$,{type:"submit",className:"w-full",disabled:E||D||V||q,children:E?"Saving...":"Save and Continue to Dashboard"})]})]})})})}},1394:(e,t,r)=>{"use strict";r.d(t,{BK:()=>o,eu:()=>i,q5:()=>u});var a=r(5155),s=r(2115),n=r(5977),l=r(9434);let i=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)(n.bL,{ref:t,className:(0,l.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",r),...s})});i.displayName=n.bL.displayName;let o=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)(n._V,{ref:t,className:(0,l.cn)("aspect-square h-full w-full object-cover",r),...s})});o.displayName=n._V.displayName;let u=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)(n.H4,{ref:t,className:(0,l.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",r),...s})});u.displayName=n.H4.displayName},1721:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(157).A)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},5695:(e,t,r)=>{"use strict";var a=r(8999);r.o(a,"useParams")&&r.d(t,{useParams:function(){return a.useParams}}),r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})},5977:(e,t,r)=>{"use strict";r.d(t,{H4:()=>b,_V:()=>v,bL:()=>j});var a=r(2115),s=r(6081),n=r(9033),l=r(2712),i=r(3540),o=r(5155),u="Avatar",[c,d]=(0,s.A)(u),[f,h]=c(u),m=a.forwardRef((e,t)=>{let{__scopeAvatar:r,...s}=e,[n,l]=a.useState("idle");return(0,o.jsx)(f,{scope:r,imageLoadingStatus:n,onImageLoadingStatusChange:l,children:(0,o.jsx)(i.sG.span,{...s,ref:t})})});m.displayName=u;var p="AvatarImage",g=a.forwardRef((e,t)=>{let{__scopeAvatar:r,src:s,onLoadingStatusChange:u=()=>{},...c}=e,d=h(p,r),f=function(e,t){let[r,s]=a.useState("idle");return(0,l.N)(()=>{if(!e)return void s("error");let r=!0,a=new window.Image,n=e=>()=>{r&&s(e)};return s("loading"),a.onload=n("loaded"),a.onerror=n("error"),a.src=e,t&&(a.referrerPolicy=t),()=>{r=!1}},[e,t]),r}(s,c.referrerPolicy),m=(0,n.c)(e=>{u(e),d.onImageLoadingStatusChange(e)});return(0,l.N)(()=>{"idle"!==f&&m(f)},[f,m]),"loaded"===f?(0,o.jsx)(i.sG.img,{...c,ref:t,src:s}):null});g.displayName=p;var x="AvatarFallback",y=a.forwardRef((e,t)=>{let{__scopeAvatar:r,delayMs:s,...n}=e,l=h(x,r),[u,c]=a.useState(void 0===s);return a.useEffect(()=>{if(void 0!==s){let e=window.setTimeout(()=>c(!0),s);return()=>window.clearTimeout(e)}},[s]),u&&"loaded"!==l.imageLoadingStatus?(0,o.jsx)(i.sG.span,{...n,ref:t}):null});y.displayName=x;var j=m,v=g,b=y},6010:()=>{},6654:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"useMergedRef",{enumerable:!0,get:function(){return s}});let a=r(2115);function s(e,t){let r=(0,a.useRef)(null),s=(0,a.useRef)(null);return(0,a.useCallback)(a=>{if(null===a){let e=r.current;e&&(r.current=null,e());let t=s.current;t&&(s.current=null,t())}else e&&(r.current=n(e,a)),t&&(s.current=n(t,a))},[e,t])}function n(e,t){if("function"!=typeof e)return e.current=t,()=>{e.current=null};{let r=e(t);return"function"==typeof r?r:()=>e(null)}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},8030:(e,t,r)=>{"use strict";r.d(t,{A:()=>d,AuthProvider:()=>c});var a=r(5155),s=r(2115),n=r(3004),l=r(5317),i=r(8214),o=r(5695);let u=(0,s.createContext)(void 0);function c(e){let{children:t}=e,[r,c]=(0,s.useState)(null),[d,f]=(0,s.useState)(!0),[h,m]=(0,s.useState)(0),p=(0,o.useRouter)(),g=(0,s.useCallback)(async e=>{if(!e)return null;let t=(0,l.H9)(i.db,"users",e.uid);try{let r=await (0,l.x7)(t);if(r.exists()){let t=r.data();return m(t.availableBalance||0),{...e,...t}}{console.log("User profile for ".concat(e.uid," not found, creating one."));let r={id:e.uid,email:e.email||"",name:e.displayName||"New User",phone:"",availableBalance:1e4,createdAt:l.Dc.now(),lastLoginAt:l.Dc.now()};return await (0,l.BN)(t,r,{merge:!0}),m(r.availableBalance),{...e,...r}}}catch(t){return console.error("Error fetching user profile:",t),e}},[]);(0,s.useEffect)(()=>{let e=(0,n.hg)(i.j2,async e=>{if(e){c(await g(e));let t=await e.getIdToken();await fetch("/api/auth/login",{method:"POST",headers:{Authorization:"Bearer ".concat(t)}})}else c(null),m(0),await fetch("/api/auth/logout",{method:"POST"});f(!1)});return()=>e()},[g]);let x={user:r,loading:d,availableBalance:h,refreshUserData:(0,s.useCallback)(async()=>{let e=i.j2.currentUser;e&&(f(!0),c(await g(e)),f(!1))},[g]),signIn:async(e,t,r)=>{let a=await (0,n.x9)(e,t,r),s=(0,l.H9)(i.db,"users",a.user.uid);return await (0,l.mZ)(s,{lastLoginAt:l.Dc.now()}),a},signUp:(e,t,r)=>(0,n.eJ)(e,t,r),signOut:async()=>{await (0,n.CI)(i.j2),p.push("/")},sendPasswordResetEmail:n.J1};return(0,a.jsx)(u.Provider,{value:x,children:t})}function d(){let e=(0,s.useContext)(u);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},8763:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(157).A)("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]])},8919:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,3063,23)),Promise.resolve().then(r.bind(r,738))},9311:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(157).A)("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]])},9737:(e,t,r)=>{"use strict";let a;r.d(t,{A:()=>i});let s={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)},n=new Uint8Array(16),l=[];for(let e=0;e<256;++e)l.push((e+256).toString(16).slice(1));let i=function(e,t,r){if(s.randomUUID&&!t&&!e)return s.randomUUID();let i=(e=e||{}).random||(e.rng||function(){if(!a&&!(a="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return a(n)})();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){r=r||0;for(let e=0;e<16;++e)t[r+e]=i[e];return t}return function(e,t=0){return l[e[t+0]]+l[e[t+1]]+l[e[t+2]]+l[e[t+3]]+"-"+l[e[t+4]]+l[e[t+5]]+"-"+l[e[t+6]]+l[e[t+7]]+"-"+l[e[t+8]]+l[e[t+9]]+"-"+l[e[t+10]]+l[e[t+11]]+l[e[t+12]]+l[e[t+13]]+l[e[t+14]]+l[e[t+15]]}(i)}}},e=>{var t=t=>e(e.s=t);e.O(0,[2992,3644,1686,9035,2488,1808,3063,4434,4016,8441,1684,7358],()=>t(8919)),_N_E=e.O()}]);