(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6996],{172:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(157).A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},2160:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(157).A)("Gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]])},4165:(e,t,a)=>{"use strict";a.d(t,{Cf:()=>m,Es:()=>h,L3:()=>x,c7:()=>f,lG:()=>d,rr:()=>p,zM:()=>c});var r=a(5155),n=a(2115),s=a(5821),i=a(5318),l=a(9434);let d=s.bL,c=s.l9,o=s.ZL;s.bm;let u=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)(s.hJ,{ref:t,className:(0,l.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...n})});u.displayName=s.hJ.displayName;let m=n.forwardRef((e,t)=>{let{className:a,children:n,...d}=e;return(0,r.jsxs)(o,{children:[(0,r.jsx)(u,{}),(0,r.jsxs)(s.UC,{ref:t,className:(0,l.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...d,children:[n,(0,r.jsxs)(s.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,r.jsx)(i.A,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});m.displayName=s.UC.displayName;let f=e=>{let{className:t,...a}=e;return(0,r.jsx)("div",{className:(0,l.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...a})};f.displayName="DialogHeader";let h=e=>{let{className:t,...a}=e;return(0,r.jsx)("div",{className:(0,l.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};h.displayName="DialogFooter";let x=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)(s.hE,{ref:t,className:(0,l.cn)("text-lg font-semibold leading-none tracking-tight",a),...n})});x.displayName=s.hE.displayName;let p=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)(s.VY,{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",a),...n})});p.displayName=s.VY.displayName},4301:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(157).A)("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]])},4477:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}(t,{callServer:function(){return r.callServer},createServerReference:function(){return s},findSourceMapURL:function(){return n.findSourceMapURL}});let r=a(3806),n=a(1818),s=a(4979).createServerReference},5127:(e,t,a)=>{"use strict";a.d(t,{A0:()=>l,BF:()=>d,Hj:()=>c,XI:()=>i,nA:()=>u,nd:()=>o});var r=a(5155),n=a(2115),s=a(9434);let i=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)("div",{className:"relative w-full overflow-auto",children:(0,r.jsx)("table",{ref:t,className:(0,s.cn)("w-full caption-bottom text-sm",a),...n})})});i.displayName="Table";let l=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)("thead",{ref:t,className:(0,s.cn)("[&_tr]:border-b",a),...n})});l.displayName="TableHeader";let d=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)("tbody",{ref:t,className:(0,s.cn)("[&_tr:last-child]:border-0",a),...n})});d.displayName="TableBody",n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)("tfoot",{ref:t,className:(0,s.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",a),...n})}).displayName="TableFooter";let c=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)("tr",{ref:t,className:(0,s.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",a),...n})});c.displayName="TableRow";let o=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)("th",{ref:t,className:(0,s.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",a),...n})});o.displayName="TableHead";let u=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)("td",{ref:t,className:(0,s.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",a),...n})});u.displayName="TableCell",n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)("caption",{ref:t,className:(0,s.cn)("mt-4 text-sm text-muted-foreground",a),...n})}).displayName="TableCaption"},5318:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(157).A)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},5599:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});let r=(0,a(157).A)("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]])},5695:(e,t,a)=>{"use strict";var r=a(8999);a.o(r,"useParams")&&a.d(t,{useParams:function(){return r.useParams}}),a.o(r,"usePathname")&&a.d(t,{usePathname:function(){return r.usePathname}}),a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}}),a.o(r,"useSearchParams")&&a.d(t,{useSearchParams:function(){return r.useSearchParams}})},6126:(e,t,a)=>{"use strict";a.d(t,{E:()=>l});var r=a(5155);a(2115);var n=a(2085),s=a(9434);let i=(0,n.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function l(e){let{className:t,variant:a,...n}=e;return(0,r.jsx)("div",{className:(0,s.cn)(i({variant:a}),t),...n})}},7751:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>P});var r=a(5155),n=a(2115),s=a(8030),i=a(5317),l=a(8214),d=a(2177),c=a(221),o=a(5594),u=a(6874),m=a.n(u),f=a(6695),h=a(5127),x=a(6126),p=a(285);let j=(0,a(157).A)("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);var b=a(4301),g=a(172),v=a(5599),y=a(2160),N=a(7481),w=a(4165),C=a(7759),A=a(2523),_=a(9409),k=a(4477);let S=(0,k.createServerReference)("40ab49258c2a399c06a63e480547aed85cab1b3af1",k.callServer,void 0,k.findSourceMapURL,"getGiftConfigurationForUser"),R=(0,k.createServerReference)("4033136359b3185ffbaa946a6b3d14526ddf058fa0",k.callServer,void 0,k.findSourceMapURL,"processGift"),E=o.Ik({recipientName:o.Yj().min(2,"Please enter the recipient's name."),recipientEmail:o.Yj().email("Please enter a valid email address."),brand:o.Yj().min(1,"Please select a brand."),amount:o.Yj().min(1,"Please enter an amount.")});function P(){let{user:e,availableBalance:t,refreshUserData:a}=(0,s.A)(),{toast:o}=(0,N.dj)(),[u,k]=(0,n.useState)([]),[P,M]=(0,n.useState)(!0),[B,L]=(0,n.useState)(!1),[U,z]=(0,n.useState)([]),[F,I]=(0,n.useState)(!0),[T,G]=(0,n.useState)(null),V=(0,d.mN)({resolver:(0,c.u)(E),defaultValues:{recipientName:"",recipientEmail:"",brand:"",amount:""}}),Y=e=>{G(U.find(t=>t.brand_code===e)||null),V.setValue("brand",e),V.setValue("amount",""),V.clearErrors("amount")},$=()=>{var e;if(!T)return"Select a brand to see amount requirements.";if(null==(e=T.denominations_in_cents)?void 0:e.length){let e=T.denominations_in_cents.map(e=>"$".concat((e/100).toFixed(2))).join(", ");return"Allowed amounts: ".concat(e)}if(T.min_price_in_cents&&T.max_price_in_cents){let e=(T.min_price_in_cents/100).toFixed(2),t=(T.max_price_in_cents/100).toFixed(2);return"Amount must be between $".concat(e," and $").concat(t,".")}return null},D=(0,n.useCallback)(()=>{if(!e)return;M(!0);let t=(0,i.query)((0,i.collection)(l.db,"gifts"),(0,i.where)("userId","==",e.uid),(0,i.My)("createdAt","desc"));return(0,i.aQ)(t,e=>{k(e.docs.map(e=>({id:e.id,...e.data()}))),M(!1)},e=>{console.error("Error fetching gifts:",e),M(!1)})},[e]);(0,n.useEffect)(()=>{let e=D();return()=>null==e?void 0:e()},[D]),(0,n.useEffect)(()=>{async function t(){if(null==e?void 0:e.region){I(!0);try{let{brands:t}=await S(e.region);z(t)}catch(e){o({variant:"destructive",title:"Error",description:"Could not load available gift brands."})}finally{I(!1)}}}e&&t()},[o,e]);let H=e=>{navigator.clipboard.writeText(e).then(()=>{o({title:"Link copied to clipboard!"})},e=>{o({variant:"destructive",title:"Failed to copy link."})})},J=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e/100);async function O(r){if(!e)return void o({variant:"destructive",title:"Authentication Error",description:"You must be logged in to create a gift."});let n=Math.round(100*parseFloat(r.amount));if(T){var s;if(null==(s=T.denominations_in_cents)?void 0:s.length){if(!T.denominations_in_cents.includes(n))return void V.setError("amount",{message:"Amount must be one of the allowed denominations."})}else if(T.min_price_in_cents&&T.max_price_in_cents&&(n<T.min_price_in_cents||n>T.max_price_in_cents))return void V.setError("amount",{message:"Amount is outside the allowed range."})}if(void 0===t||t<n)return void o({variant:"destructive",title:"Insufficient Funds",description:"You do not have enough funds to create this gift."});try{let t={userId:e.uid,recipientName:r.recipientName,recipientEmail:r.recipientEmail,brandCode:r.brand,amountInCents:n,type:"Manual",status:"Pending",claimUrl:null,createdAt:i.Dc.now()},s=await (0,i.gS)((0,i.collection)(l.db,"gifts"),t);o({title:"Gift Created",description:"Your gift is being processed and will appear in the log."}),L(!1),V.reset(),G(null),await R(s.id),await a()}catch(e){o({variant:"destructive",title:"Error",description:"Could not create the gift. Please try again."})}}return(null==e?void 0:e.region)?(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("div",{className:"w-full mx-auto space-y-8",children:[(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[(0,r.jsxs)("div",{className:"flex-grow",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold tracking-tight font-headline",children:"Gifts"}),(0,r.jsx)("p",{className:"text-muted-foreground",children:"Create and track digital gift cards for your clients."})]}),(0,r.jsxs)(w.lG,{open:B,onOpenChange:e=>{L(e),e||(V.reset(),G(null))},children:[(0,r.jsx)(w.zM,{asChild:!0,children:(0,r.jsxs)(p.$,{className:"w-full sm:w-auto",children:[(0,r.jsx)(b.A,{className:"mr-2"})," Create Gift"]})}),(0,r.jsxs)(w.Cf,{children:[(0,r.jsxs)(w.c7,{children:[(0,r.jsx)(w.L3,{children:"Create a New Gift"}),(0,r.jsx)(w.rr,{children:"Enter the details below to create a new digital gift card. The cost will be deducted from your available balance."})]}),(0,r.jsx)(C.lV,{...V,children:(0,r.jsxs)("form",{onSubmit:V.handleSubmit(O),className:"space-y-4",children:[(0,r.jsx)(C.zB,{control:V.control,name:"recipientName",render:e=>{let{field:t}=e;return(0,r.jsxs)(C.eI,{children:[(0,r.jsx)(C.lR,{children:"Recipient Name"}),(0,r.jsx)(C.MJ,{children:(0,r.jsx)(A.p,{placeholder:"Jane Doe",...t})}),(0,r.jsx)(C.C5,{})]})}}),(0,r.jsx)(C.zB,{control:V.control,name:"recipientEmail",render:e=>{let{field:t}=e;return(0,r.jsxs)(C.eI,{children:[(0,r.jsx)(C.lR,{children:"Recipient Email"}),(0,r.jsx)(C.MJ,{children:(0,r.jsx)(A.p,{placeholder:"jane.doe@example.com",...t})}),(0,r.jsx)(C.C5,{})]})}}),(0,r.jsx)(C.zB,{control:V.control,name:"brand",render:e=>{let{field:t}=e;return(0,r.jsxs)(C.eI,{children:[(0,r.jsx)(C.lR,{children:"Brand"}),(0,r.jsxs)(_.l6,{onValueChange:Y,disabled:F,children:[(0,r.jsx)(C.MJ,{children:(0,r.jsx)(_.bq,{children:(0,r.jsx)(_.yv,{placeholder:F?"Loading brands...":"Select a brand..."})})}),(0,r.jsx)(_.gC,{children:F?(0,r.jsx)("div",{className:"flex items-center justify-center p-4",children:(0,r.jsx)(g.A,{className:"h-5 w-5 animate-spin text-muted-foreground"})}):U.map(e=>(0,r.jsx)(_.eb,{value:e.brand_code,children:e.name},e.brand_code))})]}),(0,r.jsx)(C.C5,{})]})}}),(0,r.jsx)(C.zB,{control:V.control,name:"amount",render:e=>{let{field:t}=e;return(0,r.jsxs)(C.eI,{children:[(0,r.jsx)(C.lR,{children:"Amount ($)"}),(0,r.jsx)(C.MJ,{children:(0,r.jsx)(A.p,{type:"number",placeholder:"e.g., 25.00",...t,disabled:!T})}),(0,r.jsx)(C.Rr,{children:$()}),(0,r.jsx)(C.C5,{})]})}}),(0,r.jsxs)(w.Es,{children:[(0,r.jsx)(p.$,{type:"button",variant:"ghost",onClick:()=>L(!1),children:"Cancel"}),(0,r.jsx)(p.$,{type:"submit",disabled:V.formState.isSubmitting,children:V.formState.isSubmitting?"Creating...":"Create Gift"})]})]})})]})]})]}),(0,r.jsxs)(f.Zp,{children:[(0,r.jsxs)(f.aR,{children:[(0,r.jsx)(f.ZB,{children:"Gift Log"}),(0,r.jsx)(f.BT,{children:"A list of all the gifts you have created."})]}),(0,r.jsx)(f.Wu,{children:P?(0,r.jsx)("div",{className:"flex justify-center items-center h-48",children:(0,r.jsx)(g.A,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):u.length>0?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"md:hidden space-y-4",children:u.map(e=>{var t;return(0,r.jsxs)(f.Zp,{children:[(0,r.jsxs)(f.aR,{children:[(0,r.jsx)(f.ZB,{className:"text-base",children:e.recipientName}),(0,r.jsx)(f.BT,{children:e.recipientEmail})]}),(0,r.jsxs)(f.Wu,{className:"space-y-3 text-sm",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-muted-foreground",children:"Amount:"}),(0,r.jsx)("span",{className:"font-medium",children:J(e.amountInCents)})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-muted-foreground",children:"Brand:"}),(0,r.jsx)("span",{className:"font-medium",children:(null==(t=U.find(t=>t.brand_code===e.brandCode))?void 0:t.name)||e.brandCode})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("span",{className:"text-muted-foreground",children:"Status:"}),(0,r.jsx)(x.E,{variant:"Sent"===e.status?"default":"Failed"===e.status?"destructive":"secondary",children:e.status})]})]}),(0,r.jsx)(f.wL,{children:e.claimUrl?(0,r.jsxs)(p.$,{variant:"outline",size:"sm",onClick:()=>H(e.claimUrl),className:"w-full",children:[(0,r.jsx)(v.A,{className:"mr-2 h-4 w-4"})," Copy Link"]}):(0,r.jsx)(p.$,{variant:"outline",size:"sm",className:"w-full",disabled:!0,children:"Link Not Available"})})]},e.id)})}),(0,r.jsx)("div",{className:"border rounded-lg hidden md:block overflow-x-auto",children:(0,r.jsxs)(h.XI,{children:[(0,r.jsx)(h.A0,{children:(0,r.jsxs)(h.Hj,{children:[(0,r.jsx)(h.nd,{children:"Recipient"}),(0,r.jsx)(h.nd,{children:"Amount"}),(0,r.jsx)(h.nd,{children:"Brand"}),(0,r.jsx)(h.nd,{children:"Status"}),(0,r.jsx)(h.nd,{className:"text-right",children:"Link"})]})}),(0,r.jsx)(h.BF,{children:u.map(e=>{var t;return(0,r.jsxs)(h.Hj,{children:[(0,r.jsxs)(h.nA,{children:[(0,r.jsx)("div",{children:e.recipientName}),(0,r.jsx)("div",{className:"text-xs text-muted-foreground",children:e.recipientEmail})]}),(0,r.jsx)(h.nA,{children:J(e.amountInCents)}),(0,r.jsx)(h.nA,{children:e.brandCode?(0,r.jsx)("span",{children:(null==(t=U.find(t=>t.brand_code===e.brandCode))?void 0:t.name)||e.brandCode}):(0,r.jsx)("span",{children:"-"})}),(0,r.jsx)(h.nA,{children:(0,r.jsx)(x.E,{variant:"Sent"===e.status?"default":"Failed"===e.status?"destructive":"secondary",children:e.status})}),(0,r.jsx)(h.nA,{className:"text-right",children:e.claimUrl?(0,r.jsxs)(p.$,{variant:"outline",size:"sm",onClick:()=>H(e.claimUrl),children:[(0,r.jsx)(v.A,{className:"mr-2 h-4 w-4"})," Copy Link"]}):(0,r.jsx)("span",{children:"-"})})]},e.id)})})]})})]}):(0,r.jsx)("div",{className:"text-center py-16 border-2 border-dashed rounded-lg",children:(0,r.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,r.jsx)(y.A,{className:"h-8 w-8 text-muted-foreground"}),(0,r.jsx)("span",{className:"font-medium",children:"No Gifts Created Yet"}),(0,r.jsx)("span",{className:"text-sm text-muted-foreground",children:'Click "Create Gift" to send your first one.'})]})})})]})]})}):(0,r.jsx)("div",{className:"w-full mx-auto space-y-8",children:(0,r.jsxs)(f.Zp,{className:"mt-8",children:[(0,r.jsxs)(f.aR,{children:[(0,r.jsx)(f.ZB,{children:"Region Not Set"}),(0,r.jsx)(f.BT,{children:"Please set your region in your profile to use the gift-giving features."})]}),(0,r.jsx)(f.Wu,{children:(0,r.jsx)("p",{children:"Your region determines which gift card brands and currencies are available to you."})}),(0,r.jsx)(f.wL,{children:(0,r.jsx)(p.$,{asChild:!0,children:(0,r.jsxs)(m(),{href:"/user/profile",children:[(0,r.jsx)(j,{className:"mr-2"}),"Go to Profile Settings"]})})})]})})}},8030:(e,t,a)=>{"use strict";a.d(t,{A:()=>u,AuthProvider:()=>o});var r=a(5155),n=a(2115),s=a(3004),i=a(5317),l=a(8214),d=a(5695);let c=(0,n.createContext)(void 0);function o(e){let{children:t}=e,[a,o]=(0,n.useState)(null),[u,m]=(0,n.useState)(!0),[f,h]=(0,n.useState)(0),x=(0,d.useRouter)(),p=(0,n.useCallback)(async e=>{if(!e)return null;let t=(0,i.H9)(l.db,"users",e.uid);try{let a=await (0,i.x7)(t);if(a.exists()){let t=a.data();return h(t.availableBalance||0),{...e,...t}}{console.log("User profile for ".concat(e.uid," not found, creating one."));let a={id:e.uid,email:e.email||"",name:e.displayName||"New User",phone:"",availableBalance:1e4,createdAt:i.Dc.now(),lastLoginAt:i.Dc.now()};return await (0,i.BN)(t,a,{merge:!0}),h(a.availableBalance),{...e,...a}}}catch(t){return console.error("Error fetching user profile:",t),e}},[]);(0,n.useEffect)(()=>{let e=(0,s.hg)(l.j2,async e=>{if(e){o(await p(e));let t=await e.getIdToken();await fetch("/api/auth/login",{method:"POST",headers:{Authorization:"Bearer ".concat(t)}})}else o(null),h(0),await fetch("/api/auth/logout",{method:"POST"});m(!1)});return()=>e()},[p]);let j={user:a,loading:u,availableBalance:f,refreshUserData:(0,n.useCallback)(async()=>{let e=l.j2.currentUser;e&&(m(!0),o(await p(e)),m(!1))},[p]),signIn:async(e,t,a)=>{let r=await (0,s.x9)(e,t,a),n=(0,i.H9)(l.db,"users",r.user.uid);return await (0,i.mZ)(n,{lastLoginAt:i.Dc.now()}),r},signUp:(e,t,a)=>(0,s.eJ)(e,t,a),signOut:async()=>{await (0,s.CI)(l.j2),x.push("/")},sendPasswordResetEmail:s.J1};return(0,r.jsx)(c.Provider,{value:j,children:t})}function u(){let e=(0,n.useContext)(c);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},9571:(e,t,a)=>{Promise.resolve().then(a.bind(a,7751))}},e=>{var t=t=>e(e.s=t);e.O(0,[2992,3644,1686,9035,2488,6874,1808,5821,4434,4016,8441,1684,7358],()=>t(9571)),_N_E=e.O()}]);