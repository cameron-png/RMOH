(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7503],{10:(e,s,t)=>{"use strict";t.d(s,{$v:()=>p,EO:()=>m,Lt:()=>i,Rx:()=>g,Zr:()=>j,ck:()=>f,r7:()=>x,tv:()=>o,wd:()=>h});var a=t(5155),r=t(2115),l=t(2278),d=t(9434),n=t(285);let i=l.bL,o=l.l9,c=l.ZL,u=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(l.hJ,{className:(0,d.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...r,ref:s})});u.displayName=l.hJ.displayName;let m=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsxs)(c,{children:[(0,a.jsx)(u,{}),(0,a.jsx)(l.UC,{ref:s,className:(0,d.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...r})]})});m.displayName=l.UC.displayName;let h=e=>{let{className:s,...t}=e;return(0,a.jsx)("div",{className:(0,d.cn)("flex flex-col space-y-2 text-center sm:text-left",s),...t})};h.displayName="AlertDialogHeader";let f=e=>{let{className:s,...t}=e;return(0,a.jsx)("div",{className:(0,d.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...t})};f.displayName="AlertDialogFooter";let x=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(l.hE,{ref:s,className:(0,d.cn)("text-lg font-semibold",t),...r})});x.displayName=l.hE.displayName;let p=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(l.VY,{ref:s,className:(0,d.cn)("text-sm text-muted-foreground",t),...r})});p.displayName=l.VY.displayName;let g=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(l.rc,{ref:s,className:(0,d.cn)((0,n.r)(),t),...r})});g.displayName=l.rc.displayName;let j=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(l.ZD,{ref:s,className:(0,d.cn)((0,n.r)({variant:"outline"}),"mt-2 sm:mt-0",t),...r})});j.displayName=l.ZD.displayName},2346:(e,s,t)=>{"use strict";t.d(s,{w:()=>n});var a=t(5155),r=t(2115),l=t(7489),d=t(9434);let n=r.forwardRef((e,s)=>{let{className:t,orientation:r="horizontal",decorative:n=!0,...i}=e;return(0,a.jsx)(l.b,{ref:s,decorative:n,orientation:r,className:(0,d.cn)("shrink-0 bg-border","horizontal"===r?"h-[1px] w-full":"h-full w-[1px]",t),...i})});n.displayName=l.b.displayName},5466:(e,s,t)=>{Promise.resolve().then(t.bind(t,6746))},6126:(e,s,t)=>{"use strict";t.d(s,{E:()=>n});var a=t(5155);t(2115);var r=t(2085),l=t(9434);let d=(0,r.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function n(e){let{className:s,variant:t,...r}=e;return(0,a.jsx)("div",{className:(0,l.cn)(d({variant:t}),s),...r})}},6746:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>Z});var a=t(5155),r=t(2115),l=t(5317),d=t(8214),n=t(8030),i=t(285),o=t(6874),c=t.n(o),u=t(6766),m=t(6695),h=t(8186),f=t(389),x=t(286),p=t(4063),g=t(6126),j=t(2346);function v(e){let{openHouse:s,leadCount:t,feedbackCount:r,onSetActive:l}=e;if(!s.address)return(0,a.jsx)(m.Zp,{className:"flex flex-col h-full group w-full overflow-hidden",children:(0,a.jsx)("div",{className:"p-4 flex-grow flex flex-col",children:(0,a.jsx)("p",{className:"text-muted-foreground",children:"Loading address..."})})});let d=s.address.split(","),n=d[0],o=d.length>1?d.slice(1).join(",").trim():"";return(0,a.jsxs)(m.Zp,{className:"flex flex-col h-full group w-full overflow-hidden",children:[(0,a.jsx)(c(),{href:"/user/open-house/".concat(s.id),className:"block h-40 w-full relative bg-muted border-b",children:s.imageUrl?(0,a.jsx)(u.default,{src:s.imageUrl,alt:"Image of ".concat(s.address),fill:!0,className:"object-cover group-hover:scale-105 transition-transform duration-300","data-ai-hint":"house exterior"}):(0,a.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,a.jsx)(h.A,{className:"w-10 h-10 text-muted-foreground"})})}),(0,a.jsxs)("div",{className:"p-4 flex-grow flex flex-col",children:[(0,a.jsx)("div",{className:"flex-grow",children:(0,a.jsxs)("div",{className:"flex justify-between items-start gap-2",children:[(0,a.jsxs)("div",{className:"flex-grow",children:[(0,a.jsx)(c(),{href:"/user/open-house/".concat(s.id),children:(0,a.jsx)("p",{className:"font-semibold text-lg leading-tight group-hover:underline",children:n})}),o&&(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:o})]}),(0,a.jsx)("div",{className:"flex-shrink-0 mt-1",children:s.isActive?(0,a.jsxs)(g.E,{className:"bg-green-600 text-white hover:bg-green-600",children:[(0,a.jsx)(f.A,{className:"mr-1.5"}),"Active"]}):(0,a.jsx)(i.$,{onClick:()=>l(s.id),size:"sm",variant:"secondary",className:"shadow-sm",children:"Set Active"})})]})}),(0,a.jsx)(j.w,{className:"my-4"}),(0,a.jsxs)("div",{className:"flex items-center flex-wrap gap-x-4 gap-y-2 text-sm text-muted-foreground",children:[(0,a.jsxs)(c(),{href:"/user/my-leads?house=".concat(s.id),className:"hover:underline flex items-center gap-2",children:[(0,a.jsx)(x.A,{className:"w-4 h-4"}),(0,a.jsxs)("span",{children:[t," ",1===t?"Lead":"Leads"]})]}),(0,a.jsx)(j.w,{orientation:"vertical",className:"h-4 hidden sm:block"}),(0,a.jsxs)(c(),{href:"/user/open-house/".concat(s.id,"/feedback"),className:"hover:underline flex items-center gap-2",children:[(0,a.jsx)(p.A,{className:"w-4 h-4"}),(0,a.jsxs)("span",{children:[r," ",1===r?"Entry":"Entries"]})]})]})]})]})}var w=t(7759),N=t(2523),b=t(2177),y=t(221),A=t(5594),C=t(7481),S=t(881),E=t(9409),k=t(10),I=t(8803),H=t(5074),D=t(7150),L=t(8176),R=t(9434);let O=L.bL,P=L.l9,_=r.forwardRef((e,s)=>{let{className:t,align:r="center",sideOffset:l=4,...d}=e;return(0,a.jsx)(L.ZL,{children:(0,a.jsx)(L.UC,{ref:s,align:r,sideOffset:l,className:(0,R.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...d})})});_.displayName=L.UC.displayName;var U=t(9509);let z=A.Ik({address:A.Yj().min(10,{message:"Please enter a valid address."})});function Z(){let{user:e,loading:s}=(0,n.A)(),[t,o]=(0,r.useState)([]),[u,h]=(0,r.useState)(new Map),[f,p]=(0,r.useState)(new Map),[g,j]=(0,r.useState)(!0),{toast:A}=(0,C.dj)(),[L,R]=(0,r.useState)(""),[Z,F]=(0,r.useState)("newest"),[B,M]=(0,r.useState)(null),[T,V]=(0,r.useState)(!1),[Y,q]=(0,r.useState)(0),[G,$]=(0,r.useState)(null),J=(0,r.useRef)(null),W=(0,r.useRef)(null),K=(0,b.mN)({resolver:(0,y.u)(z),defaultValues:{address:""}}),X=(0,r.useCallback)(async()=>{if(e){j(!0);try{let s=(0,l.query)((0,l.collection)(d.db,"openHouses"),(0,l.where)("userId","==",e.uid),(0,l.My)("createdAt","desc")),t=(await (0,l.getDocs)(s)).docs.map(e=>({id:e.id,...e.data()}));o(t);let a=t.find(e=>e.isActive)||null;$(a);let r=l.Dc.fromDate(new Date(Date.now()-6048e5)),n=(0,l.query)((0,l.collection)(d.db,"leads"),(0,l.where)("userId","==",e.uid),(0,l.where)("createdAt",">=",r)),i=await (0,l.getDocs)(n);if(q(i.size),0===t.length)return void j(!1);let c=t.map(e=>e.id),u=(0,l.query)((0,l.collection)(d.db,"leads"),(0,l.where)("userId","==",e.uid),(0,l.where)("openHouseId","in",c)),m=await (0,l.getDocs)(u),f=new Map;m.forEach(e=>{let s=e.data();f.set(s.openHouseId,(f.get(s.openHouseId)||0)+1)}),h(f);let x=(0,l.query)((0,l.collection)(d.db,"feedbackSubmissions"),(0,l.where)("userId","==",e.uid),(0,l.where)("openHouseId","in",c)),g=await (0,l.getDocs)(x),v=new Map;g.forEach(e=>{let s=e.data();v.set(s.openHouseId,(v.get(s.openHouseId)||0)+1)}),p(v)}catch(e){console.error("Error fetching dashboard data: ",e),A({variant:"destructive",title:"Data Fetch Error",description:"Could not fetch your dashboard data."})}finally{j(!1)}}},[e,A]);(0,r.useEffect)(()=>{!s&&e&&X()},[e,s,X]),(0,r.useEffect)(()=>(U.env.NEXT_PUBLIC_GOOGLE_MAPS_API_KEY&&J.current&&new S.aH({apiKey:U.env.NEXT_PUBLIC_GOOGLE_MAPS_API_KEY,version:"weekly",libraries:["places"]}).load().then(()=>{J.current&&!W.current&&(W.current=new google.maps.places.Autocomplete(J.current,{types:["address"],componentRestrictions:{country:"us"}}),W.current.addListener("place_changed",()=>{var e;let s=null==(e=W.current)?void 0:e.getPlace();(null==s?void 0:s.formatted_address)&&K.setValue("address",s.formatted_address,{shouldValidate:!0})}))}).catch(e=>{console.error("Failed to load Google Maps API",e)}),()=>{document.querySelectorAll(".pac-container").forEach(e=>e.remove())}),[K]);let Q=(0,r.useMemo)(()=>t.filter(e=>e.address.toLowerCase().includes(L.toLowerCase())).sort((e,s)=>{let t=e.createdAt?e.createdAt.toDate().getTime():0,a=s.createdAt?s.createdAt.toDate().getTime():0;return"newest"===Z?a-t:t-a}),[t,L,Z]);async function ee(s){if(!e)return void A({variant:"destructive",title:"Authentication Error",description:"You must be logged in to create an open house."});try{let a,r=t.length>0;if(e.defaultFormId)a=e.defaultFormId;else{let e=await (0,l.x7)((0,l.H9)(d.db,"settings","appDefaults"));e.exists()&&(a=e.data().defaultGlobalFormId)}let n=await (0,l.gS)((0,l.collection)(d.db,"openHouses"),{userId:e.uid,address:s.address,createdAt:l.Dc.now(),isActive:0===t.length,feedbackFormId:a||null});K.reset(),await X(),r&&(M(n.id),V(!0))}catch(e){console.error("Error creating open house: ",e),A({variant:"destructive",title:"Error",description:"Could not create the open house. Please try again."})}}let es=async s=>{if(!e)return;let a=(0,l.wP)(d.db);t.forEach(e=>{if(e.isActive&&e.id!==s){let s=(0,l.H9)(d.db,"openHouses",e.id);a.update(s,{isActive:!1})}});let r=(0,l.H9)(d.db,"openHouses",s);a.update(r,{isActive:!0});try{await a.commit(),await X()}catch(e){console.error("Error setting active open house:",e),A({variant:"destructive",title:"Update Failed",description:"Could not update the active open house. Please try again."})}},et=async e=>{e&&B&&await es(B),V(!1),M(null)};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"w-full mx-auto space-y-8",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold tracking-tight font-headline",children:"Dashboard"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"An overview of your open house activity."})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-2",children:[(0,a.jsx)(m.Zp,{asChild:!0,children:(0,a.jsxs)(c(),{href:"/user/my-leads",children:[(0,a.jsxs)(m.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(m.ZB,{className:"text-sm font-medium",children:"New Leads (7d)"}),(0,a.jsx)(x.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsx)(m.Wu,{children:(0,a.jsx)("div",{className:"text-2xl font-bold",children:g?"...":Y})})]})}),(0,a.jsx)(m.Zp,{asChild:!0,className:"".concat(G?"bg-green-50 border-green-200 dark:bg-green-950/50 dark:border-green-800":""),children:(0,a.jsxs)(c(),{href:G?"/user/open-house/".concat(G.id):"/user/dashboard",children:[(0,a.jsxs)(m.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,a.jsx)(m.ZB,{className:"text-sm font-medium",children:"Active Open House"}),(0,a.jsx)(I.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,a.jsx)(m.Wu,{children:g?(0,a.jsx)("div",{className:"text-lg font-bold",children:"..."}):G?(0,a.jsx)("div",{className:"text-lg font-bold truncate",title:G.address,children:G.address.split(",")[0]}):(0,a.jsx)("div",{className:"text-lg font-bold",children:"None"})})]})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-8 items-start",children:[(0,a.jsxs)(m.Zp,{children:[(0,a.jsx)(m.aR,{children:(0,a.jsx)(m.ZB,{children:"Create a New Open House"})}),(0,a.jsx)(m.Wu,{children:(0,a.jsx)(w.lV,{...K,children:(0,a.jsxs)("form",{onSubmit:K.handleSubmit(ee),className:"flex flex-col sm:flex-row items-start gap-4",children:[(0,a.jsx)(w.zB,{control:K.control,name:"address",render:e=>{let{field:s}=e;return(0,a.jsxs)(w.eI,{className:"flex-grow relative form-item-container w-full",children:[(0,a.jsx)(w.lR,{className:"sr-only",children:"Address"}),(0,a.jsx)(w.MJ,{children:(0,a.jsx)(N.p,{placeholder:"123 Main St, Anytown, USA",...s,ref:J})}),(0,a.jsx)(w.C5,{className:"pt-2"})]})}}),(0,a.jsx)(i.$,{type:"submit",disabled:K.formState.isSubmitting,className:"w-full sm:w-auto",children:K.formState.isSubmitting?"Creating...":"Create"})]})})})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold tracking-tight font-headline",children:"Your Open Houses"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(O,{children:[(0,a.jsx)(P,{asChild:!0,children:(0,a.jsx)(i.$,{variant:"outline",size:"icon",children:(0,a.jsx)(H.A,{className:"h-4 w-4"})})}),(0,a.jsx)(_,{className:"w-80",align:"end",children:(0,a.jsxs)("div",{className:"grid gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h4",{className:"font-medium leading-none",children:"Search"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Find an open house by its address."})]}),(0,a.jsx)(N.p,{id:"search",placeholder:"Search by address...",value:L,onChange:e=>R(e.target.value),className:"h-9"})]})})]}),(0,a.jsxs)(O,{children:[(0,a.jsx)(P,{asChild:!0,children:(0,a.jsx)(i.$,{variant:"outline",size:"icon",children:(0,a.jsx)(D.A,{className:"h-4 w-4"})})}),(0,a.jsx)(_,{className:"w-48",align:"end",children:(0,a.jsxs)("div",{className:"grid gap-4",children:[(0,a.jsx)("div",{className:"space-y-2",children:(0,a.jsx)("h4",{className:"font-medium leading-none",children:"Sort by"})}),(0,a.jsxs)(E.l6,{value:Z,onValueChange:e=>F(e),children:[(0,a.jsx)(E.bq,{className:"h-9",children:(0,a.jsx)(E.yv,{placeholder:"Sort by"})}),(0,a.jsxs)(E.gC,{children:[(0,a.jsx)(E.eb,{value:"newest",children:"Newest first"}),(0,a.jsx)(E.eb,{value:"oldest",children:"Oldest first"})]})]})]})})]})]})]}),g?(0,a.jsx)("div",{className:"text-center py-16 border-2 border-dashed rounded-lg",children:(0,a.jsx)("p",{className:"text-muted-foreground",children:"Loading your open houses..."})}):Q.length>0?(0,a.jsx)("div",{className:"grid gap-6 md:grid-cols-2 xl:grid-cols-3",children:Q.map(e=>(0,a.jsx)(v,{openHouse:e,leadCount:u.get(e.id)||0,feedbackCount:f.get(e.id)||0,onSetActive:es},e.id))}):(0,a.jsxs)("div",{className:"text-center py-16 border-2 border-dashed rounded-lg",children:[(0,a.jsx)("h3",{className:"text-xl font-medium",children:"No Open Houses Found"}),(0,a.jsx)("p",{className:"text-muted-foreground mt-2",children:L?"Try a different search term.":"Use the form above to create your first listing."})]})]})]})]}),(0,a.jsx)(k.Lt,{open:T,onOpenChange:V,children:(0,a.jsxs)(k.EO,{children:[(0,a.jsxs)(k.wd,{children:[(0,a.jsx)(k.r7,{children:"New Open House Created"}),(0,a.jsx)(k.$v,{children:"Would you like to make this new listing the active open house for your QR code?"})]}),(0,a.jsxs)(k.ck,{children:[(0,a.jsx)(k.Zr,{onClick:()=>et(!1),children:"Not now"}),(0,a.jsx)(k.Rx,{onClick:()=>et(!0),children:"Yes, make it active"})]})]})})]})}},8030:(e,s,t)=>{"use strict";t.d(s,{A:()=>u,AuthProvider:()=>c});var a=t(5155),r=t(2115),l=t(3004),d=t(5317),n=t(8214),i=t(5695);let o=(0,r.createContext)(void 0);function c(e){let{children:s}=e,[t,c]=(0,r.useState)(null),[u,m]=(0,r.useState)(!0),[h,f]=(0,r.useState)(0),x=(0,i.useRouter)(),p=(0,r.useCallback)(async e=>{if(!e)return null;let s=(0,d.H9)(n.db,"users",e.uid);try{let t=await (0,d.x7)(s);if(t.exists()){let s=t.data();return f(s.availableBalance||0),{...e,...s}}{console.log("User profile for ".concat(e.uid," not found, creating one."));let t={id:e.uid,email:e.email||"",name:e.displayName||"New User",phone:"",availableBalance:1e4,createdAt:d.Dc.now(),lastLoginAt:d.Dc.now()};return await (0,d.BN)(s,t,{merge:!0}),f(t.availableBalance),{...e,...t}}}catch(s){return console.error("Error fetching user profile:",s),e}},[]);(0,r.useEffect)(()=>{let e=(0,l.hg)(n.j2,async e=>{if(e){c(await p(e));let s=await e.getIdToken();await fetch("/api/auth/login",{method:"POST",headers:{Authorization:"Bearer ".concat(s)}})}else c(null),f(0),await fetch("/api/auth/logout",{method:"POST"});m(!1)});return()=>e()},[p]);let g={user:t,loading:u,availableBalance:h,refreshUserData:(0,r.useCallback)(async()=>{let e=n.j2.currentUser;e&&(m(!0),c(await p(e)),m(!1))},[p]),signIn:async(e,s,t)=>{let a=await (0,l.x9)(e,s,t),r=(0,d.H9)(n.db,"users",a.user.uid);return await (0,d.mZ)(r,{lastLoginAt:d.Dc.now()}),a},signUp:(e,s,t)=>(0,l.eJ)(e,s,t),signOut:async()=>{await (0,l.CI)(n.j2),x.push("/")},sendPasswordResetEmail:l.J1};return(0,a.jsx)(o.Provider,{value:g,children:s})}function u(){let e=(0,r.useContext)(o);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}}},e=>{var s=s=>e(e.s=s);e.O(0,[2992,3644,1686,9035,2488,6874,1808,3063,5821,4434,7130,4016,8441,1684,7358],()=>s(5466)),_N_E=e.O()}]);