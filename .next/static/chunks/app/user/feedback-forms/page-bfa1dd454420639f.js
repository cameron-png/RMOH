(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6508],{462:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(157).A)("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]])},1249:(e,s,t)=>{Promise.resolve().then(t.bind(t,5468))},5300:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(157).A)("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]])},5468:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>_});var a=t(5155),l=t(2115),r=t(5317),n=t(8214),i=t(8030),c=t(9737),o=t(7481),d=t(2177),u=t(221),h=t(5594),m=t(7426),x=t(6695),j=t(285),p=t(462),f=t(4301),v=t(3561),y=t(157);let b=(0,y.A)("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);var w=t(8763);let g=(0,y.A)("FilePenLine",[["path",{d:"m18 5-2.414-2.414A2 2 0 0 0 14.172 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2",key:"142zxg"}],["path",{d:"M21.378 12.626a1 1 0 0 0-3.004-3.004l-4.01 4.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z",key:"2t3380"}],["path",{d:"M8 18h1",key:"13wk12"}]]);var N=t(5599),C=t(7223),k=t(5300),A=t(203),S=t(3926),F=t(2346),E=t(4165),q=t(10),M=t(4838),z=t(6126),I=t(7759),P=t(2523),D=t(8539),B=t(9409),O=t(5127),R=t(5695);let T=h.Ik({id:h.Yj(),value:h.Yj().min(1,"Option text cannot be empty")}),H=h.Ik({id:h.Yj(),text:h.Yj().min(3,"Question text must be at least 3 characters"),type:h.k5(["short-answer","yes-no","rating","multiple-choice"]),options:h.YO(T).optional()}),Y=h.Ik({title:h.Yj().min(3,"Title must be at least 3 characters"),questions:h.YO(H).min(1,"You must add at least one question")}),$=h.Ik({title:h.Yj().min(3,"Title must be at least 3 characters")});function _(){var e;let{user:s,refreshUserData:t}=(0,i.A)(),{toast:h}=(0,o.dj)();(0,R.useRouter)();let[y,T]=(0,l.useState)([]),[H,_]=(0,l.useState)(!0),[L,V]=(0,l.useState)(!1),[Z,J]=(0,l.useState)(null),[Q,U]=(0,l.useState)(!1),[G,W]=(0,l.useState)(null),[X,K]=(0,l.useState)(!1),[ee,es]=(0,l.useState)(null),[et,ea]=(0,l.useState)(!1),[el,er]=(0,l.useState)(null),en=(0,l.useCallback)(async()=>{if(s){_(!0);try{let e=(0,r.query)((0,r.collection)(n.db,"feedbackForms"),(0,r.where)("type","==","global")),t=(0,r.query)((0,r.collection)(n.db,"feedbackForms"),(0,r.where)("type","==","custom"),(0,r.where)("userId","==",s.uid)),[a,l]=await Promise.all([(0,r.getDocs)(e),(0,r.getDocs)(t)]),i=a.docs.map(e=>({id:e.id,...e.data()})),c=l.docs.map(e=>({id:e.id,...e.data()}));T([...c,...i])}catch(e){console.error("Error fetching forms:",e),h({variant:"destructive",title:"Error",description:"Could not fetch feedback forms."})}_(!1)}},[s,h]);(0,l.useEffect)(()=>{s&&en()},[s,en]);let ei=(0,d.mN)({resolver:(0,u.u)(Y),defaultValues:{title:"",questions:[]}}),ec=(0,d.mN)({resolver:(0,u.u)($),defaultValues:{title:""}}),{fields:eo,append:ed,remove:eu,update:eh,move:em}=(0,d.jz)({control:ei.control,name:"questions"});(0,l.useEffect)(()=>{G?ei.reset({title:G.title,questions:G.questions.map(e=>({...e}))}):ei.reset({title:"",questions:[]})},[G,ei]);let ex=ei.watch("questions"),ej=e=>{let s=ei.getValues("questions.".concat(e)),t=[...s.options||[],{id:(0,c.A)(),value:""}];eh(e,{...s,options:t})},ep=(e,s)=>{var t;let a=ei.getValues("questions.".concat(e)),l=null==(t=a.options)?void 0:t.filter((e,t)=>t!==s);eh(e,{...a,options:l})};async function ef(e){if(s)try{if(G){let s=(0,r.H9)(n.db,"feedbackForms",G.id);await (0,r.mZ)(s,e)}else await (0,r.gS)((0,r.collection)(n.db,"feedbackForms"),{...e,type:"custom",userId:s.uid,createdAt:r.Dc.now()});ek(),await en()}catch(e){console.error("Error saving form:",e),h({variant:"destructive",title:"Error",description:"Could not save the form."})}}async function ev(e){if(el)try{let s=(0,r.H9)(n.db,"feedbackForms",el.id);await (0,r.mZ)(s,{title:e.title}),eA(),await en()}catch(e){console.error("Error renaming form:",e),h({variant:"destructive",title:"Error",description:"Could not rename the form."})}}let ey=async()=>{if(ee)try{await (0,r.kd)((0,r.H9)(n.db,"feedbackForms",ee)),await en()}catch(e){console.error("Error deleting form:",e),h({variant:"destructive",title:"Delete Failed",description:"Could not delete the form."})}finally{K(!1),es(null)}},eb=async e=>{if(s)try{let t=y.filter(e=>"custom"===e.type),a={...e,type:"custom",userId:s.uid,createdAt:r.Dc.now()};delete a.id,delete a.description;let l=new Set(t.map(e=>e.title)),i="".concat(e.title," (Copy)"),o=2;for(;l.has(i);)i="".concat(e.title," (Copy ").concat(o,")"),o++;a.title=i,a.questions=a.questions.map(e=>({...e,id:(0,c.A)(),options:e.options?e.options.map(e=>({...e,id:(0,c.A)()})):[]})),await (0,r.gS)((0,r.collection)(n.db,"feedbackForms"),a),await en()}catch(e){console.error("Error copying form:",e),h({variant:"destructive",title:"Copy Failed",description:"Could not copy the form."})}},ew=async e=>{if(s)try{let a=(0,r.H9)(n.db,"users",s.uid);await (0,r.mZ)(a,{defaultFormId:e}),await t(),h({title:"Default Form Set",description:"New open houses will use this form by default."})}catch(e){console.error("Error setting default form:",e),h({variant:"destructive",title:"Error",description:"Could not set default form."})}},eg=e=>{J(e),V(!0)},eN=e=>{W(e||null),U(!0)},eC=e=>{er(e),ec.reset({title:e.title}),ea(!0)},ek=()=>{U(!1),W(null),ei.reset()},eA=()=>{ea(!1),er(null),ec.reset()},eS=e=>{es(e),K(!0)},eF=e=>{switch(e.type){case"short-answer":return(0,a.jsx)("p",{className:"text-sm text-muted-foreground italic",children:"Short text answer..."});case"yes-no":return(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(z.E,{variant:"outline",children:"Yes"}),(0,a.jsx)(z.E,{variant:"outline",children:"No"})]});case"rating":return(0,a.jsx)("div",{className:"flex gap-1 items-center",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsx)(p.A,{className:"w-5 h-5 text-muted-foreground/50"},s))});case"multiple-choice":var s;return(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:null==(s=e.options)?void 0:s.map(e=>(0,a.jsx)(z.E,{variant:"secondary",children:e.value},e.id))});default:return null}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"w-full mx-auto space-y-8",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[(0,a.jsxs)("div",{className:"flex-grow",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold tracking-tight font-headline",children:"Feedback Forms"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Create, manage, and assign feedback forms for your open houses."})]}),(0,a.jsxs)(j.$,{onClick:()=>eN(),className:"w-full sm:w-auto",children:[(0,a.jsx)(f.A,{className:"mr-2"})," Create New Form"]})]}),(0,a.jsxs)(x.Zp,{children:[(0,a.jsxs)(x.aR,{children:[(0,a.jsx)(x.ZB,{children:"All Forms"}),(0,a.jsx)(x.BT,{children:"Manage your custom forms and copy templates from the system library."})]}),(0,a.jsx)(x.Wu,{children:H?(0,a.jsx)("p",{children:"Loading your forms..."}):y.length>0?(0,a.jsx)("div",{className:"border rounded-lg overflow-x-auto",children:(0,a.jsxs)(O.XI,{children:[(0,a.jsx)(O.A0,{children:(0,a.jsxs)(O.Hj,{children:[(0,a.jsx)(O.nd,{children:"Title"}),(0,a.jsx)(O.nd,{children:"Type"}),(0,a.jsx)(O.nd,{className:"hidden sm:table-cell",children:"Questions"}),(0,a.jsx)(O.nd,{className:"hidden md:table-cell",children:"Created"}),(0,a.jsx)(O.nd,{className:"w-[100px] text-right",children:"Actions"})]})}),(0,a.jsx)(O.BF,{children:y.map(e=>(0,a.jsxs)(O.Hj,{children:[(0,a.jsx)(O.nA,{className:"font-medium",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{children:e.title}),(null==s?void 0:s.defaultFormId)===e.id&&(0,a.jsx)(z.E,{variant:"secondary",children:"Default"})]})}),(0,a.jsx)(O.nA,{children:"custom"===e.type?(0,a.jsx)(z.E,{variant:"outline",children:"Custom"}):(0,a.jsx)(z.E,{children:"System"})}),(0,a.jsx)(O.nA,{className:"hidden sm:table-cell",children:e.questions.length}),(0,a.jsx)(O.nA,{className:"hidden md:table-cell",children:e.createdAt?(0,m.GP)(e.createdAt.toDate(),"MMM d, yyyy"):"-"}),(0,a.jsx)(O.nA,{className:"text-right",children:(0,a.jsxs)(M.rI,{children:[(0,a.jsx)(M.ty,{asChild:!0,children:(0,a.jsxs)(j.$,{variant:"ghost",size:"icon",children:[(0,a.jsx)(v.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Form Actions"})]})}),(0,a.jsxs)(M.SQ,{align:"end",children:[(0,a.jsxs)(M._2,{onClick:()=>eg(e),children:[(0,a.jsx)(b,{className:"mr-2 h-4 w-4"}),(0,a.jsx)("span",{children:"View"})]}),"custom"===e.type?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(M._2,{onClick:()=>ew(e.id),disabled:(null==s?void 0:s.defaultFormId)===e.id,children:[(0,a.jsx)(p.A,{className:"mr-2 h-4 w-4"}),(0,a.jsx)("span",{children:"Make Default"})]}),(0,a.jsx)(M.mB,{}),(0,a.jsxs)(M._2,{onClick:()=>eN(e),children:[(0,a.jsx)(w.A,{className:"mr-2 h-4 w-4"}),(0,a.jsx)("span",{children:"Edit"})]}),(0,a.jsxs)(M._2,{onClick:()=>eC(e),children:[(0,a.jsx)(g,{className:"mr-2 h-4 w-4"}),(0,a.jsx)("span",{children:"Rename"})]}),(0,a.jsxs)(M._2,{onClick:()=>eb(e),children:[(0,a.jsx)(N.A,{className:"mr-2 h-4 w-4"}),(0,a.jsx)("span",{children:"Duplicate"})]}),(0,a.jsx)(M.mB,{}),(0,a.jsxs)(M._2,{onClick:()=>eS(e.id),className:"text-destructive focus:text-destructive",children:[(0,a.jsx)(C.A,{className:"mr-2 h-4 w-4"}),(0,a.jsx)("span",{children:"Delete"})]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(M.mB,{}),(0,a.jsxs)(M._2,{onClick:()=>eb(e),children:[(0,a.jsx)(N.A,{className:"mr-2 h-4 w-4"}),(0,a.jsx)("span",{children:"Copy to My Forms"})]})]})]})]})})]},e.id))})]})}):(0,a.jsxs)("div",{className:"text-center py-16 border-2 border-dashed rounded-lg",children:[(0,a.jsx)(k.A,{className:"mx-auto h-12 w-12 text-muted-foreground"}),(0,a.jsx)("h3",{className:"text-xl font-medium mt-4",children:"No Forms Found"}),(0,a.jsx)("p",{className:"text-muted-foreground mt-2 max-w-md mx-auto",children:"You haven't created any forms yet. Create one from scratch or copy a system template."})]})})]})]}),(0,a.jsx)(E.lG,{open:L,onOpenChange:V,children:(0,a.jsxs)(E.Cf,{className:"max-w-2xl",children:[(0,a.jsxs)(E.c7,{children:[(0,a.jsx)(E.L3,{children:null==Z?void 0:Z.title}),(0,a.jsx)(E.rr,{children:(null==Z?void 0:Z.description)||"A preview of the form questions."})]}),(0,a.jsx)("div",{className:"max-h-[60vh] overflow-y-auto p-1 space-y-6",children:null==Z?void 0:Z.questions.map((e,s)=>(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"font-medium",children:[s+1,". ",e.text]}),(0,a.jsx)("div",{className:"mt-2 pl-6",children:eF(e)})]},e.id))})]})}),(0,a.jsx)(E.lG,{open:Q,onOpenChange:e=>!e&&ek(),children:(0,a.jsxs)(E.Cf,{className:"max-w-3xl",children:[(0,a.jsxs)(E.c7,{children:[(0,a.jsx)(E.L3,{children:G?"Edit Form":"Create Custom Form"}),(0,a.jsx)(E.rr,{children:G?"Modify the details of your custom form.":"Design a new feedback form from scratch."})]}),(0,a.jsx)(I.lV,{...ei,children:(0,a.jsxs)("form",{onSubmit:ei.handleSubmit(ef),children:[(0,a.jsxs)("div",{className:"space-y-6 p-1 max-h-[60vh] overflow-y-auto",children:[(0,a.jsx)(I.zB,{control:ei.control,name:"title",render:e=>{let{field:s}=e;return(0,a.jsxs)(I.eI,{children:[(0,a.jsx)(I.lR,{children:"Form Title"}),(0,a.jsx)(I.MJ,{children:(0,a.jsx)(P.p,{placeholder:"e.g., My Awesome Feedback Form",...s})}),(0,a.jsx)(I.C5,{})]})}}),(0,a.jsx)(F.w,{}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"flex justify-between items-center mb-4",children:(0,a.jsx)("h3",{className:"text-lg font-medium",children:"Questions"})}),(0,a.jsx)("div",{className:"space-y-4",children:eo.map((e,s)=>{var t,l;return(0,a.jsx)(x.Zp,{className:"p-4 bg-blue-50 dark:bg-blue-950/20 border-blue-200 dark:border-blue-900/50 relative transition-all",children:(0,a.jsxs)("div",{className:"flex justify-between items-start gap-4",children:[(0,a.jsxs)("div",{className:"flex-grow space-y-4",children:[(0,a.jsx)(I.zB,{control:ei.control,name:"questions.".concat(s,".text"),render:e=>{let{field:t}=e;return(0,a.jsxs)(I.eI,{children:[(0,a.jsxs)(I.lR,{children:["Question ",s+1]}),(0,a.jsx)(I.MJ,{children:(0,a.jsx)(D.T,{placeholder:"What would you like to ask?",...t})}),(0,a.jsx)(I.C5,{})]})}}),(0,a.jsx)(I.zB,{control:ei.control,name:"questions.".concat(s,".type"),render:e=>{let{field:s}=e;return(0,a.jsxs)(I.eI,{children:[(0,a.jsx)(I.lR,{children:"Question Type"}),(0,a.jsxs)(B.l6,{onValueChange:s.onChange,defaultValue:s.value,children:[(0,a.jsx)(I.MJ,{children:(0,a.jsx)(B.bq,{children:(0,a.jsx)(B.yv,{placeholder:"Select a question type"})})}),(0,a.jsxs)(B.gC,{children:[(0,a.jsx)(B.eb,{value:"short-answer",children:"Short Answer"}),(0,a.jsx)(B.eb,{value:"yes-no",children:"Yes/No"}),(0,a.jsx)(B.eb,{value:"rating",children:"1-5 Rating"}),(0,a.jsx)(B.eb,{value:"multiple-choice",children:"Multiple Choice"})]})]}),(0,a.jsx)(I.C5,{})]})}}),(null==(t=ex[s])?void 0:t.type)==="multiple-choice"&&(0,a.jsxs)("div",{className:"space-y-3 pl-4 border-l-2 ml-2",children:[(0,a.jsx)(I.lR,{children:"Options"}),null==(l=ex[s].options)?void 0:l.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(I.zB,{control:ei.control,name:"questions.".concat(s,".options.").concat(t,".value"),render:e=>{let{field:s}=e;return(0,a.jsxs)(I.eI,{className:"flex-grow",children:[(0,a.jsx)(I.MJ,{children:(0,a.jsx)(P.p,{placeholder:"Option ".concat(t+1),...s})}),(0,a.jsx)(I.C5,{})]})}}),(0,a.jsx)(j.$,{variant:"ghost",size:"icon",onClick:()=>ep(s,t),type:"button",children:(0,a.jsx)(C.A,{className:"w-4 h-4 text-destructive"})})]},e.id)),(0,a.jsxs)(j.$,{size:"sm",variant:"outline",type:"button",onClick:()=>ej(s),children:[(0,a.jsx)(f.A,{className:"mr-2"})," Add Option"]})]})]}),(0,a.jsxs)("div",{className:"absolute top-2 right-2 flex flex-col gap-1",children:[(0,a.jsx)(j.$,{variant:"ghost",size:"icon",onClick:()=>em(s,s-1),disabled:0===s,type:"button","aria-label":"Move up",children:(0,a.jsx)(A.A,{className:"w-4 h-4"})}),(0,a.jsx)(j.$,{variant:"ghost",size:"icon",onClick:()=>em(s,s+1),disabled:s===eo.length-1,type:"button","aria-label":"Move down",children:(0,a.jsx)(S.A,{className:"w-4 h-4"})}),(0,a.jsx)(j.$,{variant:"ghost",size:"icon",onClick:()=>eu(s),type:"button","aria-label":"Delete question",className:"text-destructive hover:text-destructive",children:(0,a.jsx)(C.A,{className:"w-4 h-4"})})]})]})},e.id)})}),(0,a.jsx)(I.C5,{children:null==(e=ei.formState.errors.questions)?void 0:e.message}),(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsxs)(j.$,{size:"sm",variant:"secondary",onClick:()=>{ed({id:(0,c.A)(),text:"",type:"short-answer",options:[]})},type:"button",children:[(0,a.jsx)(f.A,{className:"mr-2"})," Add Question"]})})]})]}),(0,a.jsxs)(E.Es,{className:"mt-6 pt-4 border-t",children:[(0,a.jsx)(j.$,{type:"button",variant:"ghost",onClick:ek,children:"Cancel"}),(0,a.jsx)(j.$,{type:"submit",disabled:ei.formState.isSubmitting,children:ei.formState.isSubmitting?"Saving...":"Save Form"})]})]})})]})}),(0,a.jsx)(E.lG,{open:et,onOpenChange:e=>!e&&eA(),children:(0,a.jsxs)(E.Cf,{className:"sm:max-w-[425px]",children:[(0,a.jsxs)(E.c7,{children:[(0,a.jsx)(E.L3,{children:"Rename Form"}),(0,a.jsxs)(E.rr,{children:["Enter a new title for your form '",null==el?void 0:el.title,"'."]})]}),(0,a.jsx)(I.lV,{...ec,children:(0,a.jsxs)("form",{onSubmit:ec.handleSubmit(ev),className:"space-y-4 py-4",children:[(0,a.jsx)(I.zB,{control:ec.control,name:"title",render:e=>{let{field:s}=e;return(0,a.jsxs)(I.eI,{children:[(0,a.jsx)(I.lR,{children:"New Title"}),(0,a.jsx)(I.MJ,{children:(0,a.jsx)(P.p,{placeholder:"Enter a new title",...s})}),(0,a.jsx)(I.C5,{})]})}}),(0,a.jsxs)(E.Es,{children:[(0,a.jsx)(j.$,{type:"button",variant:"ghost",onClick:eA,children:"Cancel"}),(0,a.jsx)(j.$,{type:"submit",disabled:ec.formState.isSubmitting,children:ec.formState.isSubmitting?"Saving...":"Save"})]})]})})]})}),(0,a.jsx)(q.Lt,{open:X,onOpenChange:K,children:(0,a.jsxs)(q.EO,{children:[(0,a.jsxs)(q.wd,{children:[(0,a.jsx)(q.r7,{children:"Are you sure?"}),(0,a.jsx)(q.$v,{children:"This action cannot be undone. This will permanently delete this custom form."})]}),(0,a.jsxs)(q.ck,{children:[(0,a.jsx)(q.Zr,{onClick:()=>es(null),children:"Cancel"}),(0,a.jsx)(q.Rx,{onClick:ey,className:"bg-destructive hover:bg-destructive/90",children:"Yes, delete form"})]})]})})]})}},5695:(e,s,t)=>{"use strict";var a=t(8999);t.o(a,"useParams")&&t.d(s,{useParams:function(){return a.useParams}}),t.o(a,"usePathname")&&t.d(s,{usePathname:function(){return a.usePathname}}),t.o(a,"useRouter")&&t.d(s,{useRouter:function(){return a.useRouter}}),t.o(a,"useSearchParams")&&t.d(s,{useSearchParams:function(){return a.useSearchParams}})},8030:(e,s,t)=>{"use strict";t.d(s,{A:()=>u,AuthProvider:()=>d});var a=t(5155),l=t(2115),r=t(3004),n=t(5317),i=t(8214),c=t(5695);let o=(0,l.createContext)(void 0);function d(e){let{children:s}=e,[t,d]=(0,l.useState)(null),[u,h]=(0,l.useState)(!0),[m,x]=(0,l.useState)(0),j=(0,c.useRouter)(),p=(0,l.useCallback)(async e=>{if(!e)return null;let s=(0,n.H9)(i.db,"users",e.uid);try{let t=await (0,n.x7)(s);if(t.exists()){let s=t.data();return x(s.availableBalance||0),{...e,...s}}{console.log("User profile for ".concat(e.uid," not found, creating one."));let t={id:e.uid,email:e.email||"",name:e.displayName||"New User",phone:"",availableBalance:1e4,createdAt:n.Dc.now(),lastLoginAt:n.Dc.now()};return await (0,n.BN)(s,t,{merge:!0}),x(t.availableBalance),{...e,...t}}}catch(s){return console.error("Error fetching user profile:",s),e}},[]);(0,l.useEffect)(()=>{let e=(0,r.hg)(i.j2,async e=>{if(e){d(await p(e));let s=await e.getIdToken();await fetch("/api/auth/login",{method:"POST",headers:{Authorization:"Bearer ".concat(s)}})}else d(null),x(0),await fetch("/api/auth/logout",{method:"POST"});h(!1)});return()=>e()},[p]);let f={user:t,loading:u,availableBalance:m,refreshUserData:(0,l.useCallback)(async()=>{let e=i.j2.currentUser;e&&(h(!0),d(await p(e)),h(!1))},[p]),signIn:async(e,s,t)=>{let a=await (0,r.x9)(e,s,t),l=(0,n.H9)(i.db,"users",a.user.uid);return await (0,n.mZ)(l,{lastLoginAt:n.Dc.now()}),a},signUp:(e,s,t)=>(0,r.eJ)(e,s,t),signOut:async()=>{await (0,r.CI)(i.j2),j.push("/")},sendPasswordResetEmail:r.J1};return(0,a.jsx)(o.Provider,{value:f,children:s})}function u(){let e=(0,l.useContext)(o);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}}},e=>{var s=s=>e(e.s=s);e.O(0,[2992,3644,1686,9035,2488,1808,5821,4434,6914,7426,3247,4016,1477,8441,1684,7358],()=>s(1249)),_N_E=e.O()}]);