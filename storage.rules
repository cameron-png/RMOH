
rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    
    // Helper function to check if the user is authenticated
    function isAuthenticated() {
      return request.auth != null;
    }

    // Allow public read access to all files.
    // This is generally safe if file names are not guessable (e.g., using UUIDs).
    // Logos, property images, etc., need to be public for the app to display them.
    match /{allPaths=**} {
      allow read;
    }
    
    // Allow authenticated users to write to their own designated folders.
    // This rule allows users to upload profile pictures and logos into a folder
    // named after their unique UID.
    match /profile-pictures/{userId}/{fileName} {
      allow write: if isAuthenticated() && request.auth.uid == userId;
    }
    match /personal-logos/{userId}/{fileName} {
      allow write: if isAuthenticated() && request.auth.uid == userId;
    }
    match /brokerage-logos/{userId}/{fileName} {
      allow write: if isAuthenticated() && request.auth.uid == userId;
    }
    match /open-house-images/{userId}/{houseId}/{fileName} {
      allow write: if isAuthenticated() && request.auth.uid == userId;
    }
  }
}
